vec2 changeScaleColor(float iGlobalTime, float frameInterval){
    const float maxV = 2.0;
    float zoom = 0.94;
    float realInterval = 0.04 * frameInterval;
    float triWaveIndex = floor(iGlobalTime/realInterval);
    float zerothTriWave = iGlobalTime - realInterval * triWaveIndex;
    float timeK = frameInterval * 0.04 * 0.5;
    float halfInterval = frameInterval * 0.02;
    if(int(zerothTriWave / (realInterval/2.0)) == 0){
        return vec2(1.0 + (zoom-1.0)*zerothTriWave/halfInterval, maxV * zerothTriWave/timeK);
    }
    else{
        return vec2(2.0*zoom-1.0+(1.0-zoom)*zerothTriWave/halfInterval, 2.0*maxV - maxV*zerothTriWave/timeK);
    }
}

vec3 blueColor(vec3 rgb,float time)
{
    vec3 blue = vec3(0.0);
    blue.r = rgb.r * time;
    blue.g = rgb.g * 0.0;
    blue.b = rgb.b * 0.0;
    return blue;
}
vec3 redColor(vec3 rgb, float time)
{
    vec3 red = vec3(0.0);
    red.r = rgb.r * 0.0;
    red.g = rgb.g * 0.0;
    red.b = rgb.b * time;
    return red;
}
vec3 greenColor(vec3 rgb, float time)
{
    vec3 green = vec3(0.0);
    green.r = rgb.r * 0.0;
    green.g = rgb.g * time;
    green.b = rgb.b * 0.0;
    return green;
}

float Sample(vec2 uv, vec2 offset)
{
    float factor = iResolution.y / 433.0;
    vec4 color = INPUT(uv + (offset / iResolution.xy) * factor);
    return dot(color.rgb, vec3(0.114, 0.587, 0.299));
}

float SobelFilter(vec2 uv)
{
    float tl = Sample(uv, vec2(-1.0, 1.0));
    float tc = Sample(uv, vec2(0.0, 1.0));
    float tr = Sample(uv, vec2(1.0, 1.0));
    
    float l = Sample(uv, vec2(-1.0, 0.0));
    float c = Sample(uv, vec2(0.0, 0.0));
    float r = Sample(uv, vec2(1.0, 0.0));
    
    float bl = Sample(uv, vec2(-1.0, -1.0));
    float bc = Sample(uv, vec2(0.0, -1.0));
    float br = Sample(uv, vec2(1.0, -1.0));
    
    float gx = tl - tr + 2.0 * l - 2.0 * r + bl - br;
    float gy = -tl - 2.0 * tc - tr + bl + 2.0 * bc + br;
    
    return gx * gx + gy * gy;
}

vec4 FUNCNAME(vec2 tc)
{
    float intensity = float(PREFIX(alpha))/100.0;
    float frameTime = PREFIX(global_time);
    float moveSpeed = 60.0-float(PREFIX(moveSpeed))*0.5;
    
    float horiMove = (float(PREFIX(horizontalMove))-50.0) / 500.0;
    float vertialMove = (float(PREFIX(vertialMove))-50.0) / 500.0;
    
    vec4 fragColor = vec4(0.0);
    vec2 index = changeScaleColor(frameTime, moveSpeed);

    vec4 orig = INPUT(tc);
    vec2 uv = 2.0 * tc - 1.0;
        
    vec2 uv1 = vec2(tc.x + 0.03*sin(uv.x) - horiMove, tc.y - 0.02*sin(uv.y)+ 0.02 - vertialMove) * index.x;
    float matt1 = step(0.0, uv1.x) * step(uv1.x, 1.0) * step(0.0, uv1.y) * step(uv1.y, 1.0);
    
    vec2 uv2 = vec2(tc.x - 0.03*sin(uv.x) - horiMove, tc.y - 0.06*sin(uv.y)+ 0.02 - vertialMove)*index.x;
    float matt2 = step(0.0, uv2.x) * step(uv2.x, 1.0) * step(0.0, uv2.y) * step(uv2.y, 1.0);
    
    vec2 uv3 = vec2(tc.x - horiMove, tc.y - 0.04*sin(uv.y)+ 0.02 - vertialMove)*index.x;
    float matt3 = step(0.0, uv3.x) * step(uv3.x, 1.0) * step(0.0, uv3.y) * step(uv3.y, 1.0);
            
    float sobelA = SobelFilter(uv1);
    vec3 gradColor = redColor(vec3(sobelA), index.y) * matt1;
    fragColor += vec4(gradColor, sobelA * index.y);
    
    float sobelB = SobelFilter(uv2);
    gradColor = blueColor(vec3(sobelB), index.y) * matt2;
    fragColor += vec4(gradColor, sobelB * index.y);
    
    float sobelC = SobelFilter(uv3);
    gradColor = greenColor(vec3(sobelC), index.y) * matt3;
    fragColor += vec4(gradColor, sobelC * index.y);

    fragColor += orig;
    fragColor = clamp(fragColor, 0.0, 1.0);
    
    return mix(orig, fragColor, intensity);
}
